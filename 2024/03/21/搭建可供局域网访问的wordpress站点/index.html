<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><meta name="theme-color" content="#2d4356"><meta name="baidu-site-verification"><title>搭建可供局域网访问的wordpress站点 | wxdespair</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script><script>MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']] // 添加这行来支持行间公式
  },
  svg: {
    fontCache: 'global'
  }
};
</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script><meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="wxdespair" type="application/atom+xml">
</head><link rel="stylesheet" type="text/css" href="/plugins/highlight/atom-one-dark.min.css"><script type="text/javascript" src="/plugins/highlight/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><script type="text/javascript" src="/js/ready.js" async></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">wxdespair</a></h1></div><p class="m-desc">最令人所惧之事，无非不可见。</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/archives/">归档</a></li><li><span class="dot">●</span><a href="/categories/">分类</a></li><li><span class="dot">●</span><a href="/tags/">标签</a></li><li><span class="dot">●</span><a href="/about/">关于</a></li><li><span class="dot">●</span><a href="/atom.xml">RSS</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="搜索" onfocus="if(this.value=='搜索'){this.value='';}" onblur="if(this.value==''){this.value='搜索';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">搭建可供局域网访问的wordpress站点</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/2024/03/21/%E6%90%AD%E5%BB%BA%E5%8F%AF%E4%BE%9B%E5%B1%80%E5%9F%9F%E7%BD%91%E8%AE%BF%E9%97%AE%E7%9A%84wordpress%E7%AB%99%E7%82%B9/">2024-03-21</a></span><span class="p-category"><i class="fa fa-folder"></i><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><blockquote>
<p>旨在部署可供局域网下访问的 wordpress 站点，可用于存储一些笔记、博客等</p>
</blockquote>
<h3 id="0-部署所需环境"><a href="#0-部署所需环境" class="headerlink" title="0. 部署所需环境"></a>0. 部署所需环境</h3><blockquote>
<p><code>2024年2月28日</code> 官网需求</p>
<p>运行系统：<code>Win11 22H2</code></p>
</blockquote>
<ul>
<li><code>PHP 7.4+</code></li>
<li><code>MySQL 5.7+</code> or <code>MariaDB 10.3+</code></li>
<li><code>Apache</code> or <code>Nginx</code></li>
</ul>
<h3 id="1-Install-PHP"><a href="#1-Install-PHP" class="headerlink" title="1. Install PHP"></a>1. Install PHP</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://windows.php.net/download/">官网下载地址</a></p>
<p>示例使用版本为：VS16 x64 Thread Safe (2024-Feb-13 23:36:38)</p>
</blockquote>
<ol>
<li>下载 php 安装文件压缩包</li>
<li>解压压缩包并移动到想要安装的位置</li>
<li>修改配置文件：将安装文件夹中的 <code>php.ini-development</code>(开发) 或 <code>php.ini-production</code>(产品) 复制一份并重命名为 <code>php.ini</code></li>
<li>开启 <code>mysqli</code> 扩展：启用 3 中 <code>php.ini</code> 文件中的 <code>;extension=mysqli</code> ，即去除注释符号 <code>;</code>，其他扩展可酌情开启</li>
<li>修改扩展目录：修改 3 中 <code>php.ini</code> 文件中的 <code>extension_dir</code> 条目，一般设置为 <code>phpinstallpath/ext</code>，即解压出来的目录中的 <code>ext</code> 子目录的路径</li>
<li>将 <code>php</code> 路径添加到系统环境变量</li>
<li>验证安装成功：在命令行输入 <code>php -v</code> ，若输出正常版本信息则证明安装成功</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt; php -v</span></span><br><span class="line">PHP 8.3.3 (cli) (built: Feb 13 2024 23:17:12) (ZTS Visual C++ 2019 x64)</span><br><span class="line">Copyright (c) The PHP Group</span><br><span class="line">Zend Engine v4.3.3, Copyright (c) Zend Technologies</span><br></pre></td></tr></table></figure>

<h3 id="2-Install-MySQL"><a href="#2-Install-MySQL" class="headerlink" title="2. Install MySQL"></a>2. Install MySQL</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/">官网下载地址</a></p>
<p>示例使用版本为：8.0.36 Microsoft Windows Windows (x86, 64-bit), ZIP Archive</p>
</blockquote>
<ol>
<li>下载 mysql 安装文件压缩包</li>
<li>解压压缩包并移动到想要安装的位置</li>
<li>创建配置文件：在安装文件夹中创建名为 <code>my.ini</code> 的配置文件，在文件中写入如下内容，并修改 <code>basedir</code> 与 <code>datadir</code> 条目，其他条目可根据</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment"># 设置3306端口</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"><span class="comment"># 设置mysql的安装目录</span></span><br><span class="line"><span class="attr">basedir</span>=D:\mysql-<span class="number">8.0</span>.<span class="number">23</span>-winx64</span><br><span class="line"><span class="comment"># 设置mysql数据库的数据的存放目录，这个data目录不用手动创建，会在后面初始化的时候自动创建</span></span><br><span class="line"><span class="attr">datadir</span>=D:\mysql-<span class="number">8.0</span>.<span class="number">23</span>-winx64\data</span><br><span class="line"><span class="comment"># 允许最大连接数</span></span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">200</span></span><br><span class="line"><span class="comment"># 允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统</span></span><br><span class="line"><span class="attr">max_connect_errors</span>=<span class="number">10</span></span><br><span class="line"><span class="comment"># 服务端使用的字符集默认为UTFMB4</span></span><br><span class="line"><span class="attr">character-set-server</span>=utf8mb4</span><br><span class="line"><span class="comment"># 创建新表时将使用的默认存储引擎</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=INNODB</span><br><span class="line"><span class="comment"># 默认使用“mysql_native_password”插件认证</span></span><br><span class="line"><span class="attr">default_authentication_plugin</span>=mysql_native_password</span><br><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="comment"># 设置mysql客户端默认字符集</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="comment"># 设置mysql客户端连接服务端时默认使用的端口</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>将 mysql 路径中的 <code>bin</code> 子目录添加到系统环境变量</li>
<li>以管理员身份打开命令行，移动到 mysql 路径中的 <code>bin</code> 子目录下，输入<br><code>mysqld --initialize –console</code> 进行初始化，成功后会显示初始初始密码，后面需要使用<br>如果输入命令后除了增加data文件外无返回，可以尝试输出<br><code>mysqld --no-defaults --initialize --console</code> ，基本会正常输出</li>
<li>在命令行输入 <code>mysqld --install mysql</code> 进行安装，输出 <code>Service successfully installed.</code> 即表示安装成功</li>
<li>在命令行输入 <code>net start mysql</code> 启动 mysql 服务</li>
<li>在命令行输入 <code>mysql -u root -p</code> 进入 mysql ，在 <code>Enter password：</code> 后输入 5 中初始化的密码</li>
<li>在数据库中输入 <code>alter user &#39;root&#39;@localhost identified by &#39;123456&#39;</code> 进行密码修改，将其中 <code>123456</code> 替换为要设置的密码，这里只是示例</li>
<li>在数据库中输入 <code>quit</code> 退出，再次使用 <code>mysql -u root -p</code> 进入数据库，如果新设置的密码可以成功进入，则表示密码设置成功</li>
<li>为 wordpress 创建专用的用户与数据库，并赋予对专用数据库的所有权限</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 创建新的用户，这里@&#x27;localhost&#x27;指定了用户可以从本地主机连接。如果需要该用户能够从任何主机连接，可以将localhost替换为&#x27;%&#x27;</span><br><span class="line">CREATE USER &#x27;new_user&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;password&#x27;;</span><br><span class="line"></span><br><span class="line"># 创建新的数据库</span><br><span class="line">CREATE DATABASE new_database;</span><br><span class="line"></span><br><span class="line"># 为用户赋权</span><br><span class="line">GRANT ALL PRIVILEGES ON new_database.* TO &#x27;new_user&#x27;@&#x27;localhost&#x27;;</span><br><span class="line"></span><br><span class="line"># 刷新权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<h3 id="3-Install-Nginx"><a href="#3-Install-Nginx" class="headerlink" title="3. Install Nginx"></a>3. Install Nginx</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://nginx.org/en/download.html">官网下载地址</a></p>
<p>示例使用版本：nginx&#x2F;Windows-1.24.0</p>
</blockquote>
<ol>
<li>下载 nginx 安装文件压缩包</li>
<li>解压压缩包并移动到想要安装的位置</li>
<li>将 nginx 安装路径添加到系统环境变量</li>
<li>在命令行移动到 nginx 安装路径，运行 <code>nginx</code>（添加完环境变量后应该可以在任意位置运行）</li>
<li>可以使用 <code>tasklist /fi &quot;imagename eq nginx.exe&quot;</code> 命令查看 <code>nginx</code> 的任务进程是否存在，或者直接在任务管理器中查看</li>
<li>打开浏览器，输入 <code>localhost</code> （默认端口80），如果出现 nginx 的欢迎界面即表示安装成功</li>
<li>修改配置文件：<code>nginxinstallpath/conf</code> 路径下的 <code>nginx.conf</code> 是 nginx 的配置文件</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # # nginx.conf 配置文件详解</span></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="comment">#==工作进程数，一般设置为cpu核心数</span></span><br><span class="line">worker_processes  1<span class="comment">;</span></span><br><span class="line"><span class="comment"># 日志文件路径，做好修改一下，以防止日志写入造成的错误</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    <span class="comment">#==最大连接数，一般设置为cpu*2048</span></span><br><span class="line">    worker_connections  1024<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types<span class="comment">;</span></span><br><span class="line">    default_type  application/octet-stream<span class="comment">;</span></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line">    sendfile        on<span class="comment">;</span></span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="comment">#==客户端链接超时时间</span></span><br><span class="line">    keepalive_timeout  65<span class="comment">;</span></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line">    <span class="comment">#当配置多个server节点时，默认server names的缓存区大小就不够了，需要手动设置大一点</span></span><br><span class="line">    server_names_hash_bucket_size 512<span class="comment">;</span></span><br><span class="line">    <span class="comment">#server表示虚拟主机可以理解为一个站点，可以配置多个server节点搭建多个站点</span></span><br><span class="line">    <span class="comment">#每一个请求进来确定使用哪个server由server_name确定</span></span><br><span class="line">    server &#123;</span><br><span class="line">        <span class="comment">#站点监听端口</span></span><br><span class="line">        listen       8800<span class="comment">;</span></span><br><span class="line">        <span class="comment">#站点访问域名</span></span><br><span class="line">        server_name  localhost<span class="comment">;</span></span><br><span class="line">        <span class="comment">#编码格式，避免url参数乱码</span></span><br><span class="line">        charset utf-8<span class="comment">;</span></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line">        <span class="comment">#location用来匹配同一域名下多个URI的访问规则</span></span><br><span class="line">        <span class="comment">#比如动态资源如何跳转，静态资源如何跳转等</span></span><br><span class="line">        <span class="comment">#location后面跟着的/代表匹配规则</span></span><br><span class="line">        location / &#123;</span><br><span class="line">            <span class="comment">#站点根目录，可以是相对路径，也可以使绝对路径</span></span><br><span class="line">            root   html<span class="comment">;</span></span><br><span class="line">            <span class="comment">#默认主页</span></span><br><span class="line">            index  index.html index.htm<span class="comment">;</span></span><br><span class="line">            <span class="comment">#转发后端站点地址，一般用于做软负载，轮询后端服务器</span></span><br><span class="line">            <span class="comment">#proxy_pass http://10.11.12.237:8080;</span></span><br><span class="line">            <span class="comment">#拒绝请求，返回403，一般用于某些目录禁止访问</span></span><br><span class="line">            <span class="comment">#deny all;</span></span><br><span class="line">            <span class="comment">#允许请求</span></span><br><span class="line">            <span class="comment">#allow all;</span></span><br><span class="line">            add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;<span class="comment">;</span></span><br><span class="line">            add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;<span class="comment">;</span></span><br><span class="line">            add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;<span class="comment">;</span></span><br><span class="line">            add_header &#x27;Access-Control-Allow-Headers&#x27; &#x27;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type&#x27;<span class="comment">;</span></span><br><span class="line">            <span class="comment">#重新定义或者添加发往后端服务器的请求头</span></span><br><span class="line">            <span class="comment">#给请求头中添加客户请求主机名</span></span><br><span class="line">            proxy_set_header Host $host<span class="comment">;</span></span><br><span class="line">            <span class="comment">#给请求头中添加客户端IP</span></span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr<span class="comment">;</span></span><br><span class="line">            <span class="comment">#将$remote_addr变量值添加在客户端“X-Forwarded-For”请求头的后面，并以逗号分隔。 如果客户端请求未携带“X-Forwarded-For”请求头，$proxy_add_x_forwarded_for变量值将与$remote_addr变量相同  </span></span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for<span class="comment">;</span></span><br><span class="line">            <span class="comment">#给请求头中添加客户端的Cookie</span></span><br><span class="line">            proxy_set_header Cookie $http_cookie<span class="comment">;</span></span><br><span class="line">            <span class="comment">#将使用代理服务器的主域名和端口号来替换。如果端口是80，可以不加。</span></span><br><span class="line">            proxy_redirect off<span class="comment">;</span></span><br><span class="line">            <span class="comment">#浏览器对 Cookie 有很多限制，如果 Cookie 的 Domain 部分与当前页面的 Domain 不匹配就无法写入。</span></span><br><span class="line">            <span class="comment">#所以如果请求 A 域名，服务器 proxy_pass 到 B 域名，然后 B 服务器输出 Domian=B 的 Cookie，</span></span><br><span class="line">            <span class="comment">#前端的页面依然停留在 A 域名上，于是浏览器就无法将 Cookie 写入。</span></span><br><span class="line">            </span><br><span class="line">　　         <span class="comment">#不仅是域名，浏览器对 Path 也有限制。我们经常会 proxy_pass 到目标服务器的某个 Path 下，</span></span><br><span class="line">            <span class="comment">#不把这个 Path 暴露给浏览器。这时候如果目标服务器的 Cookie 写死了 Path 也会出现 Cookie 无法写入的问题。</span></span><br><span class="line">            <span class="comment">#设置“Set-Cookie”响应头中的domain属性的替换文本，其值可以为一个字符串、正则表达式的模式或一个引用的变量</span></span><br><span class="line">            <span class="comment">#转发后端服务器如果需要Cookie则需要将cookie domain也进行转换，否则前端域名与后端域名不一致cookie就会无法存取</span></span><br><span class="line">　　　　　　  <span class="comment">#配置规则：proxy_cookie_domain serverDomain(后端服务器域) nginxDomain(nginx服务器域)</span></span><br><span class="line">            proxy_cookie_domain localhost .testcaigou800.com<span class="comment">;</span></span><br><span class="line">            <span class="comment">#取消当前配置级别的所有proxy_cookie_domain指令</span></span><br><span class="line">            <span class="comment">#proxy_cookie_domain off;</span></span><br><span class="line">            <span class="comment">#与后端服务器建立连接的超时时间。一般不可能大于75秒；</span></span><br><span class="line">            proxy_connect_timeout 30<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        error_page   500 502 503 504  /50x.html<span class="comment">;</span></span><br><span class="line">        <span class="attr">location</span> = /<span class="number">50</span>x.html &#123;</span><br><span class="line">            root   html<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">　　<span class="comment">#当需要对同一端口监听多个域名时，使用如下配置，端口相同域名不同，server_name也可以使用正则进行配置</span></span><br><span class="line">　　<span class="comment">#但要注意server过多需要手动扩大server_names_hash_bucket_size缓存区大小</span></span><br><span class="line">　　server &#123;</span><br><span class="line">　　　　listen 80<span class="comment">;</span></span><br><span class="line">　　　　server_name www.abc.com<span class="comment">;</span></span><br><span class="line">　　　　charset utf-8<span class="comment">;</span></span><br><span class="line">　　　　location / &#123;</span><br><span class="line">　　　　　　proxy_pass http://localhost:10001<span class="comment">;</span></span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;</span><br><span class="line">　　server &#123;</span><br><span class="line">　　　　listen 80<span class="comment">;</span></span><br><span class="line">　　　　server_name aaa.abc.com<span class="comment">;</span></span><br><span class="line">　　　　charset utf-8<span class="comment">;</span></span><br><span class="line">　　　　location / &#123;</span><br><span class="line">　　　　　　proxy_pass http://localhost:20002<span class="comment">;</span></span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>为 wordpress 创建服务，在配置文件的 <code>http</code> 块中添加下列内容，最好将全局的日志文件的路径也修改一下，使用绝对路径防止出错</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    <span class="comment"># wordpress 站点对外访问端口</span></span><br><span class="line">    listen       88<span class="comment">;</span></span><br><span class="line">    <span class="comment"># nginx服务块名称，用以匹配服务块，可以修改为 wordpress 站点的域名，局域网也可以修改为ip地址，用空格对多个地址进行分割</span></span><br><span class="line">    server_name  localhost<span class="comment">;</span></span><br><span class="line">    client_max_body_size 100M<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置为后面wordpress的安装路径，特别注意，如果路径中有空格，就要将路径用引号括起，因为空格在当前配置中的作用是分隔两个参数</span></span><br><span class="line">    root   &quot;D:/Program Files/wordpress&quot;<span class="comment">;</span></span><br><span class="line">    index  index.php index.html index.htm<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ /index.php?$args<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        <span class="comment"># 用于 PHP-FPM 进程监听使用，以便与 PHP 进行通讯</span></span><br><span class="line">        fastcgi_pass   127.0.0.1:9000<span class="comment">;</span></span><br><span class="line">        fastcgi_index  index.php<span class="comment">;</span></span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name<span class="comment">;</span></span><br><span class="line">        include        fastcgi_params<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-Install-wordpress"><a href="#4-Install-wordpress" class="headerlink" title="4. Install wordpress"></a>4. Install wordpress</h3><blockquote>
<p> <a target="_blank" rel="noopener" href="https://cn.wordpress.org/download/">官网下载地址</a></p>
<p> 示例使用版本为：wordpress 6.4.3</p>
</blockquote>
<ol>
<li>下载 wordpress 安装文件压缩包</li>
<li>解压压缩包并移动到想要安装的位置，也就是后面站点的源文件路径</li>
<li>修改配置文件：复制 <code>wp-config-sample.php</code> ，并将副本修改文件名为 <code>wp-config.php</code> </li>
<li>修改配置文件中与数据库连接、网络地址有关的条目</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The name of the database for WordPress */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>( <span class="string">&#x27;DB_NAME&#x27;</span>, <span class="string">&#x27;wordpressdb&#x27;</span> );</span><br><span class="line"><span class="comment">/** Database username */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>( <span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;wordpressuser&#x27;</span> );</span><br><span class="line"><span class="comment">/** Database password */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>( <span class="string">&#x27;DB_PASSWORD&#x27;</span>, <span class="string">&#x27;wordpresspassword&#x27;</span> );</span><br><span class="line"><span class="comment">/** Database hostname */</span> <span class="comment">// 数据库相对于wordpress的访问地址，如果数据库与wordpress在同一机器，使用 localhost 访问即可</span></span><br><span class="line"><span class="title function_ invoke__">define</span>( <span class="string">&#x27;DB_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span> );</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>根据 <strong>5. run wordpress</strong> 的步骤启动站点服务，在网页中会提示各种安装需求，如果前面的设置有误，可以根据提示进行修正，在所有条件满足后，点击<strong>安装</strong>，等待安装完毕（时间不长，示例操作时小于1分钟）</li>
<li>安装完成后会跳转到账户注册界面，完成注册</li>
<li>注册完成后会跳转到仪表盘界面，如果一些功能都能正常使用，页面可以正常跳转，就表示 wordpress 初始站点部署完毕</li>
</ol>
<h3 id="5-run-wordpress"><a href="#5-run-wordpress" class="headerlink" title="5. run wordpress"></a>5. run wordpress</h3><p>在本文示例的俺咋混个方式中运行 wordpress 站点需要<strong>启动两个服务</strong>：</p>
<ol>
<li>PHP-FPM 监听程序：用于与 PHP 通讯，在命令行运行下面的命令，其中的地址是在 nginx 配置文件相应服务块中的 <code>fastcgi_pass</code> 参数，务必要与其一致，否则无法正常通信，页面会无法访问</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php-cgi.exe -b 127.0.0.1:9000</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>nginx 服务：用于站点源文件的前端展示，在命令行运行下面的命令启动 nginx 服务，并手动指定配置文件。原因是 nginx 启动时会在默认位置查找配置文件，windows 系统下的默认路径为 <code>C:\nginx\conf\nginx.conf</code> ，如果安装的路径与这个路径不同，就需要手动指定配置文件的路径</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -c D:\nginxinstallpath\conf\nginx.conf</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在浏览器输入访问地址以访问 wordpress 站点页面，示例使用 <code>http://localhost:88</code></li>
</ol>
<h3 id="6-待解决问题"><a href="#6-待解决问题" class="headerlink" title="6. 待解决问题"></a>6. 待解决问题</h3><blockquote>
<p>问题一：目前存在一个问题，就是使用 localhost 部署页面，使用局域网地址访问，只能访问到主界面，<strong>跳转其他界面都会回到以 localhost 为地址的页面</strong>，非本机器无法访问，需要手动修改 localhost 为站点的局域网地址</p>
<p>(在固定IP的服务器的优势不仅是随时随地访问，还有网络位置不变~~~)</p>
<p>方法一：</p>
<ol>
<li>在 wordpress 仪表盘中设置站点地址为局域网地址，（最好启用一个插件，名为<code>Velvet Blues Update URLs</code>，作用是自动替换所有页面的地址为新地址，未独立验证效果）当切换页面时，默认的localhost就会变成设置的局域网地址</li>
<li>弊端：当站点在局域网下的地址更换时，需要再次修改</li>
</ol>
<p>方法二（不推荐）：</p>
<ol>
<li>在hosts文件中添加一个局域网地址对应的条目，使用该条目设置 wordpress 地址，可以不用每次修改设置，到哪需要修改hosts文件</li>
<li>弊端：在访问端也需要设置hosts文件，且频繁修改不安全容易污染网络环境</li>
</ol>
</blockquote>
<blockquote>
<p>问题二：对 markdown 与 latex 的支持不太好，不能导入 markdown 文件直接得到文章</p>
<p>方法：有插件支持 markdown 语法，也有插件支持 latex 公式渲染，但和本地的 typora 支持还是有所欠缺</p>
<p>（这方面，hexo 更适用，可以通过 markdown 文件直接生成相应的静态文件，且对公式的支持也还可以）</p>
<p>相关的插件有：</p>
<ol>
<li>WP Markdown Editor：这是一个允许你在WordPress中使用Markdown编辑器的插件。虽然它本身不支持LaTeX公式，但你可以配合其他插件使用，比如下面的插件。</li>
<li>Jetpack by WordPress.com：Jetpack是WordPress官方提供的一款功能强大的插件，它包含了许多功能模块。其中的Markdown模块可以让你在编辑文章时使用Markdown语法，而且它还可以支持LaTeX公式的显示。</li>
<li>WP GitHuber MD：这是另一个支持Markdown语法的插件，它提供了丰富的Markdown编辑功能，并且支持LaTeX公式。</li>
<li>WP QuickLaTeX：虽然它不是一个Markdown编辑器，但它可以让你在文章中使用LaTeX语法编写数学公式，并且能够实时渲染显示。</li>
<li>WP KaTeX：类似于WP QuickLaTeX，WP KaTeX是一个用于在WordPress文章中渲染LaTeX公式的插件。它提供了一个简单的短代码来插入LaTeX公式，并且支持实时预览。</li>
</ol>
</blockquote>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">本文作者：</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">WX</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">本文链接：</span><span class="p-copytight-value"><a href="/2024/03/21/%E6%90%AD%E5%BB%BA%E5%8F%AF%E4%BE%9B%E5%B1%80%E5%9F%9F%E7%BD%91%E8%AE%BF%E9%97%AE%E7%9A%84wordpress%E7%AB%99%E7%82%B9/">https://wxdespair.github.io/2024/03/21/搭建可供局域网访问的wordpress站点/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">版权声明：</span><span class="p-copytight-value">本博客所有文章除特殊声明外，均采用<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>许可协议。转载请注明出处 <a href="https://wxdespair.github.io">WX的博客</a>！</span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tag"></i><a href="/tags/wordpress/">wordpress</a></span></div><aside id="toc"><div class="toc-title">目录</div><nav><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-%E9%83%A8%E7%BD%B2%E6%89%80%E9%9C%80%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">0. 部署所需环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Install-PHP"><span class="toc-number">2.</span> <span class="toc-text">1. Install PHP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Install-MySQL"><span class="toc-number">3.</span> <span class="toc-text">2. Install MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Install-Nginx"><span class="toc-number">4.</span> <span class="toc-text">3. Install Nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Install-wordpress"><span class="toc-number">5.</span> <span class="toc-text">4. Install wordpress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-run-wordpress"><span class="toc-number">6.</span> <span class="toc-text">5. run wordpress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%BE%85%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98"><span class="toc-number">7.</span> <span class="toc-text">6. 待解决问题</span></a></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/2024/03/21/%E6%90%AD%E5%BB%BAhexo%E7%AB%99%E7%82%B9-2024/">&lt; 搭建hexo站点-2024</a><a class="next" href="/2024/03/21/ssh-github%E5%A4%9A%E7%94%A8%E6%88%B7/">ssh-github多用户 &gt;</a></div><div id="valine-comment"><style type="text/css">.night .v[data-class=v] a { color: #0F9FB4 !important; }
.night .v[data-class=v] a:hover { color: #216C73 !important; }
.night .v[data-class=v] li { list-style: inherit; }
.night .v[data-class=v] .vwrap { border: 1px solid #223441; border-radius: 0; }
.night .v[data-class=v] .vwrap:hover { box-shadow: 0 0 6px 1px #223441; }
.night .v[data-class=v] .vbtn { border-radius: 0; background: none; }
.night .v[data-class=v] .vlist .vcard .vh { border-bottom-color: #293D4E; }
.night .v[data-class=v] .vwrap .vheader .vinput { border-bottom-color: #223441; }
.night .v[data-class=v] .vwrap .vheader .vinput:focus { border-bottom-color: #339EB4; }
.night .v[data-class=v] code, .night .v[data-class=v] pre,.night .v[data-class=v] .vlist .vcard .vhead .vsys { background: #203240 !important; }
.night .v[data-class=v] code, .night .v[data-class=v] pre { color: #F0F0F0; font-size: 95%; }
.v[data-class=v] .vcards .vcard .vh {border-bottom-color: #223441; }
.night .v[data-class=v] .vcards .vcard .vcontent.expand:before {background: linear-gradient(180deg,rgba(38,57,73,.4),rgba(38,57,73,.9));}
.night .v[data-class=v] .vcards .vcard .vcontent.expand:after {background: rgba(38,57,73,.9)}
</style><div id="vcomment"></div><script src="//cdn.bootcdn.net/ajax/libs/valine/1.4.14/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'',
  appKey:'',
  lang: 'zh-cn',
  placeholder:'ヾﾉ≧∀≦)o Come on, say something...',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></section><footer><p>Copyright © 2016 - 2024 <a href="/." rel="nofollow">wxdespair</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/js/search.js"></script><script type="text/javascript" src="/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script></body></html>